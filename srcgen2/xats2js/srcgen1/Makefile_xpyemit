########################################################################
########################################################################
# Makefile for bootstrapping
########################################################################
########################################################################
CAT=cat
SED=sed
ECHO=echo
MAKE=make
NODE=node
########################################################################
########################################################################
all:: lib2xats2js
########################################################################
########################################################################
clean:: ; rm -f *~
cleanall:: ; rm -f *~
########################################################################
cleanall:: ; \
rm -f BUILD/PY/*_sats_out0.py
cleanall:: ; \
rm -f BUILD/PY/*_dats_out?.py
########################################################################
########################################################################
SRCGEN2=./../../../srcgen2
XATSPYD=./../../../srcgen2/xats2py
########################################################################
#
SRCSATS := \
intrep0.sats \
intrep1.sats \
trxd3i0.sats \
trxi0i1.sats \
xats2js.sats \
js1emit.sats \
#
########################################################################
#
SRCDATS := \
intrep0.dats \
intrep0_print0.dats \
intrep0_utils0.dats \
intrep1.dats \
intrep1_print0.dats \
intrep1_utils0.dats \
trxd3i0.dats \
trxd3i0_myenv0.dats \
trxd3i0_dynexp.dats \
trxd3i0_decl00.dats \
trxi0i1.dats \
trxi0i1_myenv0.dats \
trxi0i1_dynexp.dats \
trxi0i1_decl00.dats \
xats2js.dats \
xats2js_utils0.dats \
xats2js_myenv0.dats \
xats2js_dynexp.dats \
xats2js_decl00.dats \
xats2js_tmplib.dats \
js1emit.dats \
js1emit_utils0.dats \
js1emit_dynexp.dats \
js1emit_decl00.dats \
#
########################################################################
########################################################################
OUT0SATS := \
$(patsubst %.sats, BUILD/PY/%_sats_out0.py, $(SRCSATS))
OUT0DATS := \
$(patsubst %.dats, BUILD/PY/%_dats_out0.py, $(SRCDATS))
OUT1DATS := \
$(patsubst %.dats, BUILD/PY/%_dats_out1.py, $(SRCDATS))
########################################################################
########################################################################
-include .depend_xpyemit
########################################################################
########################################################################
BUILD/PY/%_sats_out0.py: SATS/%.sats; \
$(NODE) --stack-size=4096 $(XATSOPT_TCHECK00) $< > $@
BUILD/PY/%_dats_out0.py: DATS/%.dats; \
$(NODE) --stack-size=4096 $(XATS2PY_PYEMIT00) $< > $@
########################################################################
########################################################################
ifndef XATSOPT_TCHECK00
XATSOPT_TCHECK00=$(SRCGEN2)/UTIL/xatsopt_tcheck00_ats2.js
endif ## (ifeq($(XATSOPT_TCHECK00),""))
########################################################################
ifndef XATS2PY_PYEMIT00
XATS2PY_PYEMIT00=$(XATSPYD)/srcgen1/UTIL/xats2py_pyemit00_ats2.js
endif ## (ifeq($(XATS2PY_PYEMIT00),""))
########################################################################
########################################################################
#
# HX-2025-05-24:
# Doing arithmetic in Makefile
#
N001="X"
N002=$(N001) $(N001)
N004=$(N002) $(N002)
N008=$(N004) $(N004)
N016=$(N008) $(N008)
N032=$(N016) $(N016)
N064=$(N032) $(N032)
N128=$(N064) $(N064)
N256=$(N128) $(N128)
N512=$(N256) $(N256)
NFILE=$(N064) $(N032) $(N004) # 100=064+032+004
##################################################################
BUILD/PY/%_dats_out1.py: \
BUILD/PY/%_dats_out0.py; \
$(eval NFILE=$(NFILE) X) \
$(SED) -e 's/pyxtnm/pyx$(words $(NFILE))tnm/g' $< > $@
##################################################################
lib2xats2js: $(OUT1DATS); $(CAT) $(OUT1DATS) > lib/lib2xats2js.py
########################################################################
########################################################################
#######################(end-of-[Makefile_xpyemit])######################
