########################################################################
########################################################################
# Makefile for XSYNCPY
########################################################################
########################################################################
CAT=cat
SED=sed
ECHO=echo
MAKE=make
NODE=node
########################################################################
SRCGEN2=./../../../srcgen2
XATSJSD=./../../../srcgen2/xats2js
########################################################################
########################################################################
all:: lib2xsyncpy
########################################################################
########################################################################
clean:: ; rm -f *~
########################################################################
cleanall:: ; rm -f *~
cleanall:: ; rm -f BUILD/JS/*_sats_out0.js
cleanall:: ; rm -f BUILD/JS/*_dats_out?.js
########################################################################
########################################################################

SRCSATS := \
lexing0.sats \
dynexp0.sats \
dynexp1.sats \
statyp2.sats \
dynexp2.sats \
dynexp3.sats \

########################################################################

SRCDATS := \
lexing0.dats \
lexing0_print0.dats \
dynexp2.dats \
dynexp2_print0.dats \
dynexp3.dats \
dynexp3_print0.dats \

########################################################################
########################################################################
OUTSATS := \
$(patsubst %.sats, \
  BUILD/JS/%_sats_out0.js, $(SRCSATS))
OUT0DATS := \
$(patsubst %.dats, \
  BUILD/JS/%_dats_out0.js, $(SRCDATS))
OUT1DATS := \
$(patsubst %.dats, \
  BUILD/JS/%_dats_out1.js, $(SRCDATS))
########################################################################
########################################################################
-include .depend_xjsemit
########################################################################
########################################################################
#
BUILD/JS/%_sats_out0.js: \
./SATS/%.sats; \
$(NODE) --stack-size=8800 $(XATSOPT_TCHECK00) $< > $@
#
BUILD/JS/%_dats_out0.js: \
./DATS/%.dats; \
$(NODE) --stack-size=8800 $(XATS2JS_JSEMIT00) $< > $@
#
########################################################################
########################################################################
N001="X"
N002=$(N001) $(N001)
N004=$(N002) $(N002)
N008=$(N004) $(N004)
N016=$(N008) $(N008)
N032=$(N016) $(N016)
N064=$(N032) $(N032)
N128=$(N064) $(N064)
N256=$(N128) $(N128)
N512=$(N256) $(N256)
NFILE=$(N064) $(N032) $(N004) # 100=064+032+004
########################################################################
BUILD/JS/%_dats_out1.js: \
BUILD/JS/%_dats_out0.js; \
$(eval NFILE=$(NFILE) X) \
$(SED) -e 's/jsxtnm/jsx$(words $(NFILE))tnm/g' $< > $@
########################################################################
lib2xsyncpy: \
$(OUT1DATS); \
$(CAT) $(OUT1DATS) > lib/lib2xsyncpy.js
########################################################################
ifndef XATS2JS_TCHECK00
XATSOPT_TCHECK00=$(SRCGEN2)/UTIL/xatsopt_tcheck00_ats2.js
endif ## (ifeq($(XATS2JS_TCHECK00),""))
########################################################################
ifndef XATS2JS_JSEMIT00
XATS2JS_JSEMIT00=$(XATSJSD)/srcgen1/UTIL/xats2js_jsemit00_ats2.js
endif ## (ifeq($(XATS2JS_JSEMIT00),""))
########################################################################
########################################################################
#######################(end of [Makefile_xjsemit])######################
